import{m as t,r as e,p as n,s as a,c as s,l,a as o,b as i,z as r,d,i as c,e as h,t as p,h as u,f as g,g as m,o as f,P as v,j as b,k as x,u as y,n as w,q as M,w as _,v as k,x as $,y as C,F as B,A as E,B as L,C as S,D as N,E as D,G as z,H as P,I as V,J as A,K as O,L as j,M as I,N as G,O as J}from"./vendor.1069cdf8.js";var K=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get svg(){return dt},get g(){return ct},get asstSvg(){return ht},get foreign(){return pt}});const W=t();var Y={container:"Mindmap_container_fgvb6","svg-wrapper":"Mindmap_svg-wrapper_fgvb6","asst-svg":"Mindmap_asst-svg_fgvb6",svg:"Mindmap_svg_fgvb6",trigger:"Mindmap_trigger_fgvb6",dragging:"Mindmap_dragging_fgvb6","add-btn":"Mindmap_add-btn_fgvb6",hidden:"Mindmap_hidden_fgvb6","expand-btn":"Mindmap_expand-btn_fgvb6",text:"Mindmap_text_fgvb6",selected:"Mindmap_selected_fgvb6",content:"Mindmap_content_fgvb6",root:"Mindmap_root_fgvb6",edited:"Mindmap_edited_fgvb6",outline:"Mindmap_outline_fgvb6",collapse:"Mindmap_collapse_fgvb6","button-list":"Mindmap_button-list_fgvb6","right-bottom":"Mindmap_right-bottom_fgvb6","right-top":"Mindmap_right-top_fgvb6",disabled:"Mindmap_disabled_fgvb6",gps:"Mindmap_gps_fgvb6",fit:"Mindmap_fit_fgvb6",download:"Mindmap_download_fgvb6",prev:"Mindmap_prev_fgvb6",next:"Mindmap_next_fgvb6",close:"Mindmap_close_fgvb6"};const H=e(),R=e(),T=e(),U=e(),q=e(),F=e();function X(){const t=this.querySelector(`g.${Y["add-btn"]}`);t&&(t.style.opacity="1")}function Z(){const t=this.querySelector(`g.${Y["add-btn"]}`);t&&(t.style.opacity="0")}const Q=(t,e)=>{t.stopPropagation(),le(e)};function tt(t,e){var n,a;const s=null==(n=this.parentNode)?void 0:n.parentNode,{foreign:l}=K;if(Ot&&l&&F.value){s.classList.add(Y.edited),W.emit("edit-flag",!1),l.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-hn.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const t=F.value;t.textContent=e.name,t.focus(),null==(a=getSelection())||a.selectAllChildren(t);const n=s.querySelector(`:scope > .${Y.content}`);n&&he(n)}}const et=()=>{var t;if(null==(t=document.getElementsByClassName(Y.edited)[0])||t.classList.remove(Y.edited,Y.selected),q.value&&F.value){q.value.style.display="none";const t=q.value.getAttribute("data-id"),e=q.value.getAttribute("data-name"),n=F.value.textContent;t&&null!==n&&n!==e&&un(t,n)}},nt=t=>{if(t.preventDefault(),!H.value)return;const e=se(H.value,t);gt.value=e;const n=t.composedPath().find((t=>{var e;return null==(e=t.classList)?void 0:e.contains("node")}));if(n){const{classList:t}=n,e=t.contains(Y.root),a=t.contains(Y.collapse);t.contains(Y.selected)||le(n),vt.value.disabled=e,Mt.value.disabled=e,$t.value.disabled=e,yt.value.disabled=e,wt.value.disabled=e,xt.value.disabled=e,ft.value.disabled=!a,mt.value.disabled=a||t.contains("leaf"),ut.value=!1}else ut.value=!0;W.emit("showContextmenu",!0)},at=t=>{var e,n;switch(t){case"zoomfit":ce();break;case"zoomin":case"zoomout":pe(!0);break;case"add":st(new MouseEvent("click"),oe());break;case"delete":vn(oe().id);break;case"delete-one":bn(oe().id);break;case"collapse":yn(oe().id);break;case"expand":xn(oe().id);break;case"add-sibling":{const t=oe(),e=wn(t.id,"");e&&lt(e)}break;case"add-sibling-before":{const t=oe(),e=wn(t.id,"",!0);e&&lt(e)}break;case"add-parent":{const t=oe(),e=Mn(t.id,"");e&&lt(e)}break;case"cut":{const{id:t}=oe(),n=null==(e=hn.find(t))?void 0:e.rawData;n&&navigator.clipboard.writeText(JSON.stringify(n)),vn(t)}break;case"copy":{const t=oe(),e=null==(n=hn.find(t.id))?void 0:n.rawData;e&&navigator.clipboard.writeText(JSON.stringify(e))}break;case"paste":{const t=oe();navigator.clipboard.readText().then((e=>{const n=fe(e)||{name:e};fn(t.id,n)}))}}},st=(t,e)=>{const n=fn(e.id,"");n&&lt(n,t)};function lt(t,e=new MouseEvent("click")){const{g:n}=K;if(!n)return;const a=n.selectAll(`g[data-id='${xe(t)}'] > g.${Y.content} > g.${Y.text}`).node();a&&(W.emit("edit-flag",!0),tt.call(a,e,t))}const ot=(t,e)=>{xn(e.id)};const it=t=>{const{svg:e}=K;e&&(t?(Ut(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},rt=t=>{H.value&&(t?H.value.addEventListener("contextmenu",nt):H.value.removeEventListener("contextmenu",nt))};let dt,ct,ht,pt;W.on("selection-svg",(t=>dt=t)),W.on("selection-g",(t=>ct=t)),W.on("selection-asstSvg",(t=>ht=t)),W.on("selection-foreign",(t=>pt=t));const ut=e(!0),gt=e({left:0,top:0}),mt=e({title:"Collapse node",name:"collapse",disabled:!0}),ft=e({title:"Expand node",name:"expand",disabled:!0}),vt=e({title:"Delete node ",name:"delete",disabled:!1}),bt=e({title:"New child node",name:"add",disabled:!1}),xt=e({title:"New parent node",name:"add-parent",disabled:!1}),yt=e({title:"New sibling node",name:"add-sibling",disabled:!1}),wt=e({title:"Create a new sibling node before this ",name:"add-sibling-before",disabled:!0}),Mt=e({title:"Cut",name:"cut",disabled:!1}),_t=e({title:"Copy",name:"copy",disabled:!1}),kt=e({title:"Paste",name:"paste",disabled:!1}),$t=e({title:"Delete a single node",name:"delete-one",disabled:!1}),Ct=s((()=>[[bt.value,xt.value,yt.value,wt.value],[Mt.value,_t.value,kt.value,vt.value,$t.value],[{title:"Select all",name:"selectall",disabled:!0}],[mt.value,ft.value]])),Bt=s((()=>[[{title:"Zoom in",name:"zoomin",disabled:Tt.value.k>=At[1]},{title:"Zoom out",name:"zoomout",disabled:Tt.value.k<=At[0]},{title:"Zoom fit",name:"zoomfit",disabled:!1}],[{title:"Select all",name:"selectall",disabled:!0}]])),Et=s((()=>ut.value?Bt.value:Ct.value)),Lt=l().source((t=>t.source)).target((t=>t.target)),St=o().curve(i),Nt=({source:t,target:e})=>St([t,e]);let Dt=!1,zt=Lt;const Pt=e(!1);W.on("sharp-corner",(t=>{Dt!==t&&(Pt.value=!0),Dt=!!t,zt=t?Nt:Lt}));let Vt=4;W.on("branch",(t=>Vt=t||Vt));let At=[.1,8];W.on("scale-extent",(t=>At=t||At));let Ot=!1;W.on("edit-flag",(t=>Ot=!!t));let jt=18,It=84,Gt=Math.min(jt/2-1,10);W.on("gap",(t=>{t&&(It=t.xGap,jt=t.yGap,Gt=Math.min(jt/2-1,10),Gt=Math.min(It/2-1,Gt))}));const Jt=new ResizeObserver((t=>{const{foreign:e}=K;if(!e)return;const n=t[0],a=n.target,{width:s,height:l}=n.contentRect,o=2*(parseInt(getComputedStyle(a).paddingLeft||"0",10)+parseInt(getComputedStyle(a.parentNode).borderTopWidth||"0",10));e.attr("width",s+o).attr("height",l+o),"none"!==e.style("display")&&he(a)})),Kt={side:12,padding:2,margin:8},Wt=Kt.side+2*Kt.padding,Yt=16,Ht=4,Rt=2,Tt=e(c),Ut=r().on("zoom",(t=>{const{g:e}=K;e&&(Tt.value=t.transform,e.attr("transform",t.transform.toString()))})).scaleExtent(At),qt=d().container((function(){var t,e;return null==(e=null==(t=this.parentNode)?void 0:t.parentNode)?void 0:e.parentNode})).on("drag",(function(t,e){var a;const s=null==(a=this.parentNode)?void 0:a.parentNode;R.value&&R.value.classList.add(Y.dragging);const{g:l}=K;if(!l)return;re(s,e,[t.x-e.x,t.y-e.y]);const o=n(t,T.value);o[1]+=hn.data.y;const i=l.selectAll("g.node").filter((t=>{if(t!==e&&t!==e.parent&&!t.id.startsWith(e.id)){let e=Gt,n=t.width+Gt;t.left&&0!==t.depth&&([e,n]=[n,e]);const a={x0:t.x-e,x1:t.x+n,y0:t.y-Gt,y1:t.y+t.height+Gt};return o[0]>a.x0&&o[1]>a.y0&&o[0]<a.x1&&o[1]<a.y1}return!1})),r=Array.from(document.getElementsByClassName(Y.outline)),d=i.node();r.forEach((t=>{t!==d&&t.classList.remove(Y.outline)})),null==d||d.classList.add(Y.outline)})).on("end",(function(t,e){var n;const s=null==(n=this.parentNode)?void 0:n.parentNode;R.value&&R.value.classList.remove(Y.dragging);const l=document.getElementsByClassName(Y.outline)[0];if(l){l.classList.remove(Y.outline);const t=l.getAttribute("data-id");if(!t)throw new Error("outline data-id null");return e.px=0,e.py=0,void gn(t,e.id)}const o=e.x-hn.getRootWidth()/2,i=1===e.depth&&o*(o+e.px)<0,r=i?t=>t.left!==e.left:t=>t.left===e.left,d=s.parentNode;let c=i?{y:1/0,id:e.id}:e,h=i?{y:-1/0,id:e.id}:e;const p=a(d).selectAll(`g.${ve(e).join(".")}`).filter((t=>t!==e&&r(t))),u=e.y+e.py;p.each((t=>{(i||t.y>e.y)&&t.y<u&&t.y>h.y&&(h=t),(i||t.y<e.y)&&t.y>u&&t.y<c.y&&(c=t)})),c.id!==e.id?(e.px=0,e.py=0,mn(e.id,c.id)):h.id!==e.id?(e.px=0,e.py=0,mn(e.id,h.id,1)):i?(e.px=0,e.py=0,_n(e.id)):re(s,e,[0,0],500)})),Ft=e(!1);let Xt;W.on("mindmap-context",(t=>t?Xt=t:null));const Zt={drag:!1,edit:!1};const Qt=new class{constructor(t=20){this.length=t,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(t){const e=h.cloneDeep(t);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(e),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,h.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,h.cloneDeep(this.snapshots[this.cursor])):null}},te=e(!1),ee=e(!1),ne=t=>{const e=t.split("\n");return e.length>1&&""===e[e.length-1]&&e.pop(),e},ae=(t,e)=>p().duration(t).ease(e),se=(t,e)=>{const{pageX:n,pageY:a}=e,s=t.getBoundingClientRect();return{left:n-(s.left+window.pageXOffset),top:a-(s.top+window.pageYOffset)}};function le(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${xe(t)}']`),n=document.getElementsByClassName(Y.selected)[0];if(!e)throw new Error("selectGNode failed");n?n!==e?(n.classList.remove(Y.selected),e.classList.add(Y.selected)):W.emit("edit-flag",!0):e.classList.add(Y.selected)}function oe(){return a(`.${Y.selected}`).data()[0]}const ie=t=>{const{asstSvg:e}=K;if(!e)throw new Error("asstSvg undefined");const n=ne(t),a=e.append("text");a.selectAll("tspan").data(n).enter().append("tspan").text((t=>t)).attr("x",0);const s=a.node().getBBox();return a.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*n.length}},re=(t,e,n,s=0)=>{const l=ae(s,g);e.px=n[0],e.py=n[1],a(t).transition(l).attr("transform",be),a(`g[data-id='${xe(e)}'] > path`).transition(l).attr("d",(t=>we(t)))},de=()=>{const{svg:t}=K;if(!t)return;const e=hn.data;Ut.translateTo(t,0+e.width/2,0+e.height/2)},ce=()=>{const{svg:t}=K;if(!t||!T.value||!R.value)return;const e=T.value.getBBox(),n=R.value.getBoundingClientRect(),a=Math.min(n.width/e.width,n.height/e.height),s=n.width/2,l=n.height/2,o=e.width*a/2,i=e.height*a/2,r=c.translate(-e.x*a+s-o,-e.y*a+l-i).scale(a);Ut.transform(t,r)},he=t=>{const{svg:e}=K;if(e&&R.value){const{k:n}=Tt.value,a=t.getBoundingClientRect(),{x:s,y:l,width:o,height:i}=R.value.getBoundingClientRect(),r=a.x-s,d=r+a.width,c=a.y-l,h=c+a.height,p=2;let u=0,g=0;r<0&&(u=-r/n+p),(a.width>o||d>o)&&(u=-(d-o)/n-p),c<0&&(g=-c/n+p),(a.height>i||h>i)&&(g=-(h-i)/n-p),Ut.translateBy(e,u,g)}},pe=t=>{const{svg:e}=K;e&&Ut.scaleBy(e,t?1.1:.9)},ue=()=>{var t,e;H.value&&(t=H.value,e=hn.data.name,u(t).then((t=>{const n=t.toDataURL(),a=open();a&&(a.document.write(`<img src='${n}'>`),a.document.title=e,a.document.close())})))},ge=()=>{const t=Qt.next();t&&(hn.data=t,pn(!1))},me=()=>{const t=Qt.prev();t&&(hn.data=t,pn(!1))},fe=t=>{let e;try{return e=JSON.parse(t),"name"in e&&e}catch(n){return!1}},ve=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},be=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,xe=t=>t.id,ye=t=>{const e=ne(t.name),n=t.height/e.length;return e.map((t=>({name:t,height:n})))},we=t=>{let e=0,n=0;const a=Math.max(Gt-3,0);let s=t.width+a;let l=3;const{parent:o}=t;o&&(e=o.width,n=o.height,0===o.depth&&(Dt||(e/=2),n/=2,l=0)),t.left&&(o&&(0!==o.depth?e=-e:Dt&&(e=0)),s=-s);const i=[-t.dx+e-t.px,-t.dy+n+l-t.py],r=[0,t.height+3];return`${zt({source:i,target:r})}L${s},${r[1]}`},Me=(t,e,n,a,s)=>{t?(Se(e,10),Be(n,10,6),Ee(a,10),s&&Le(s,10)):(Se(e,Gt),Be(n,Gt),Ee(a,Gt),s&&Le(s,Gt))},_e=(t,e)=>{const n=t.attr("class",(t=>(t=>{const e=ve(t);return t&&(0===t.depth&&e.push(Y.root),t.collapse?e.push(Y.collapse):t.children&&0!==t.children.length||e.push("leaf")),e})(t).join(" "))).attr("data-id",xe);(e?n.transition(e):n).attr("transform",be)},ke=(t,e)=>{(e?t.transition(e):t).attr("transform",(t=>`translate(${t.left?-t.width:0},0)`))},$e=t=>{t.attr("alignment-baseline","text-before-edge").text((t=>t.name||" ")).attr("x",0).attr("dy",((t,e)=>e?t.height:0))},Ce=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1)},Be=(t,e,n=4)=>{t.attr("x",(t=>-e-(t.left?t.width:0))).attr("y",-e).attr("rx",n).attr("ry",n).attr("width",(t=>t.width+2*e)).attr("height",(t=>t.height+2*e))},Ee=(t,e)=>{t.attr("class",Y["expand-btn"]).attr("transform",(t=>((t,e)=>{const n=0===t.depth?t.height/2:t.height+3;let a=t.width+e+Yt/2+4;return t.left&&(a=-a),`translate(${a},${n})`})(t,e))).style("color",(t=>t.color))},Le=(t,e)=>{t.attr("class",(t=>(t=>{const e=[Y["add-btn"]];return t.collapse&&e.push(Y.hidden),e})(t).join(" "))).attr("transform",(t=>((t,e)=>{const n=0===t.depth?t.height/2:t.height+3;let a=t.width+e+Wt/2+Kt.margin;return t.left&&(a=-a),`translate(${a},${n})`})(t,e)))},Se=(t,e)=>{const n=Wt+Kt.margin,a=2*e;t.attr("class",Y.trigger).attr("x",(t=>-e-(t.left?t.width+n:0))).attr("y",-e).attr("width",(t=>t.width+a+n)).attr("height",(t=>t.height+a))},Ne=(t,e)=>{const n=t.attr("stroke",(t=>t.color)).attr("stroke-width",Vt);if(e){const t=n.transition(e);Pt.value?t.attrTween("d",De):t.attr("d",we)}else n.attr("d",we)};function De(t,e,n){const a=we(t),s=n[e],l=s.cloneNode(),o=s.getTotalLength();l.setAttribute("d",a);const i=l.getTotalLength(),r=[0],d=10/Math.max(o,i);let c=0;for(;(c+=d)<1;)r.push(c);r.push(1);const h=r.map((t=>{const e=s.getPointAtLength(t*o),n=l.getPointAtLength(t*i);return m([e.x,e.y],[n.x,n.y])}));return t=>t<1?"M"+h.map((e=>e(t))).join("L"):a}const ze=t=>{const e=t.append("tspan");return $e(e),e},Pe=t=>($e(t),t),Ve=t=>{const e=t.append("g");return(t=>{const{side:e,padding:n}=Kt,a=-n-e/2,s=e+2*n;t.attr("x",a).attr("y",a).attr("rx",4).attr("ry",4).attr("width",s).attr("height",s)})(e.append("rect")),e.append("path").attr("d",((t,e)=>{const n=-e/2,a=-t/2,s=t/2,l=e/2;return`M${l},${s}H${s}V${l}H${a}V${s}H${n}V${a}H${a}V${n}H${s}V${a}H${l}V${s}Z`})(2,Kt.side)),e},Ae=t=>{const e=Ve(t);return e.on("click",st),e},Oe=t=>{const e=t.append("g");return e.append("rect").attr("x",-Yt/2).attr("y",-Ht/2).attr("width",Yt).attr("height",Ht).attr("rx",Rt).attr("ry",Rt).attr("stroke",(t=>t.color||"grey")).attr("fill",(t=>t.color||"grey")),Ce(e.append("circle"),-4),Ce(e.append("circle"),0),Ce(e.append("circle"),4),e},je=t=>{var e;const n=!(null==(e=t.data()[0])?void 0:e.depth),a=t.append("g");_e(a),Ne(a.append("path"));const s=a.append("g").attr("class",Y.content),l=s.append("rect"),o=s.append("g").attr("class",Y.text),i=o.append("rect"),r=o.append("text");ke(r);const d=r.selectAll("tspan").data(ye).enter().append("tspan");let c;$e(d),Ft.value&&(c=Ae(s));const h=Oe(s);return Me(n,l,i,h,c),((t,e)=>{if(t.select(`:scope > g.${Y.content} > g.${Y["expand-btn"]}`).on("click",ot),Zt.drag||Zt.edit){const n=t.select(`:scope > g.${Y.content} > g.${Y.text}`);n.on("mousedown",Q),Zt.drag&&!e&&qt(n),Zt.edit&&n.on("click",tt)}Ft.value&&t.select(`:scope > g.${Y.content}`).on("mouseenter",X).on("mouseleave",Z)})(a,n),a.each(((t,e)=>{t.children&&Ge(t.children,a.filter(((t,n)=>e===n)))})),s.raise(),a},Ie=t=>{var e;const n=!(null==(e=t.data()[0])?void 0:e.depth),a=ae(500,g);_e(t,a),Ne(t.select(":scope > path"),a);const s=t.select(`:scope > g.${Y.content}`),l=s.select(":scope > rect"),o=s.select(`g.${Y.text}`),i=o.select("rect"),r=o.select("text");ke(r,a),r.selectAll("tspan").data(ye).join(ze,Pe,(t=>t.remove()));let d=s.select(`g.${Y["add-btn"]}`);const c=s.select(`g.${Y["expand-btn"]}`);return Ft.value?d.node()||(d=Ae(s)):d.remove(),Me(n,l,i,c,d),t.each(((e,n)=>{e.children&&Ge(e.children,t.filter(((t,e)=>n===e)))})),s.raise(),t},Ge=(t=[hn.data],e=ct)=>{e.selectAll(`g.${ve(t[0]).join(".")}`).data(t,(t=>t.gKey)).join(je,Ie)};class Je{constructor(t,e,n,a){this.w=t,this.h=e,this.y=n,this.c=a,this.cs=a.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function Ke(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function We(t){return t.y+t.h}class Ye{constructor(t,e,n){this.lowY=t,this.index=e,this.next=n}}function He(t,e,n){for(;null!==n&&t>=n.lowY;)n=n.next;return new Ye(t,e,n)}function Re(t,e,n,a){t.c[e].mod+=a,t.c[e].msel+=a,t.c[e].mser+=a,function(t,e,n,a){if(n!==e-1){const s=e-n;t.c[n+1].shift+=a/s,t.c[e].shift-=a/s,t.c[e].change-=a-a/s}}(t,e,n,a)}function Te(t){return 0===t.cs?t.tl:t.c[0]}function Ue(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function qe(t,e,n){let a=t.c[e-1],s=a.mod,l=t.c[e],o=l.mod;for(;null!==a&&null!==l;){We(a)>n.lowY&&(n=n.next);const i=s+a.prelim+a.w-(o+l.prelim);i>0&&(o+=i,Re(t,e,n.index,i));const r=We(a),d=We(l);r<=d&&(a=Ue(a),null!==a&&(s+=a.mod)),r>=d&&(l=Te(l),null!==l&&(o+=l.mod))}null===a&&null!==l?function(t,e,n,a){const s=t.c[0].el;s.tl=n;const l=a-n.mod-t.c[0].msel;s.mod+=l,s.prelim-=l,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,l,o):null!==a&&null===l&&function(t,e,n,a){const s=t.c[e].er;s.tr=n;const l=a-n.mod-t.c[e].mser;s.mod+=l,s.prelim-=l,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,a,s)}function Fe(t){if(0===t.cs)return void Ke(t);Fe(t.c[0]);let e=He(We(t.c[0].el),0,null);for(let n=1;n<t.cs;n++){Fe(t.c[n]);const a=We(t.c[n].er);qe(t,n,e),e=He(a,n,e)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(t),Ke(t)}function Xe(t,e){e+=t.mod,t.x=t.prelim+e,function(t){let e=0,n=0;for(let a=0;a<t.cs;a++)e+=t.c[a].shift,n+=e+t.c[a].change,t.c[a].mod+=n}(t);for(let n=0;n<t.cs;n++)Xe(t.c[n],e)}function Ze(t){Fe(t),Xe(t,0)}class Qe{constructor(t,e){this.gap=t,this.bottomPadding=e}addBoundingBox(t,e){return{width:t+this.gap,height:e+this.bottomPadding}}removeBoundingBox(t,e){return{x:t+this.gap/2,y:e}}}class tn{constructor(t){this.bb=t}layout(t){const e=this.convert(t);Ze(e);const{boundingBox:n,result:a}=this.assignLayout(e,t);return{result:a,boundingBox:n}}convert(t,e=0){const{width:n,height:a}=this.bb.addBoundingBox(t.width,t.height),s=[];if(t.children&&t.children.length)for(let l=0;l<t.children.length;l++)s[l]=this.convert(t.children[l],e+a);return new Je(n,a,e,s)}assignCoordinates(t,e){const{x:n,y:a}=this.bb.removeBoundingBox(t.x,t.y);e.x=n,e.y=a;for(let s=0;s<t.c.length;s++)this.assignCoordinates(t.c[s],e.children[s])}getSize(t,e){const{x:n,y:a,width:s,height:l}=t;if(e||(e={left:n,right:n+s,top:a,bottom:a+l}),e.left=Math.min(e.left,n),e.right=Math.max(e.right,n+s),e.top=Math.min(e.top,a),e.bottom=Math.max(e.bottom,a+l),t.children)for(const o of t.children)this.getSize(o,e);return e}assignLayout(t,e,n){const{x:a,y:s}=this.bb.removeBoundingBox(t.x,t.y);e.x=a,e.y=s;const{width:l,height:o}=e;n||(n={left:a,right:a+l,top:s,bottom:s+o}),n.left=Math.min(n.left,a),n.right=Math.max(n.right,a+l),n.top=Math.min(n.top,s),n.bottom=Math.max(n.bottom,s+o);for(let i=0;i<t.c.length;i++)this.assignLayout(t.c[i],e.children[i],n);return{result:e,boundingBox:n}}}const en=t=>[t.width,t.height]=[t.height,t.width],nn=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},an=(t,e)=>t.id=e,sn=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},ln=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},on=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},rn=(t,e,n="0")=>{var a;e.forEach((e=>{e(t,n)}));const{children:s}=t;if(s)for(let l=0;l<s.length;){const o=s[l];"del"===o.id?(s.splice(l,1),null==(a=t.rawData.children)||a.splice(l,1)):(rn(o,e,`${n}-${l}`),l+=1)}},dn=(t,e)=>{const n=new Qe(e,t);return new tn(n)};class cn{constructor(t,e,n,a,s=f(v)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.colorScale=s,this.getSize=a,this.layout=dn(e,n),this.data=this.createMdataFromData(t,"0"),this.renew()}createMdataFromData(t,e,n=null){const{name:a,collapse:s,children:l}=t,{width:o,height:i}=this.getSize(a),r=n?n.depth+1:0;let d=!1,c=n?n.color:"";1===r?(d=!!t.left,c=this.colorScale(`${this.colorNumber+=1}`)):0!==r&&n&&(d=n.left);const h={id:e,name:a,rawData:t,parent:n,left:d,color:c,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:o,height:i,children:[],_children:[],collapse:!!s,gKey:this.gKey+=1};return l&&(h.collapse?l.forEach(((t,n)=>{h._children.push(this.createMdataFromData(t,`${e}-${n}`,h))})):l.forEach(((t,n)=>{h.children.push(this.createMdataFromData(t,`${e}-${n}`,h))}))),h}renew(...t){rn(this.data,[en,sn,on]),this.data=this.l(this.data);const e=[en,this.renewXY.bind(this),nn];rn(this.data,e.concat(t))}l(t){const{left:e,right:n}=(t=>{const e=Object.assign({},t),n=Object.assign({},t);if(t.collapse);else{const{children:a}=t;e.children=[],n.children=[],a.forEach((t=>{t.left?e.children.push(t):n.children.push(t),t.parent&&(t.parent=n)}))}return{left:e,right:n}})(t);return this.layout.layout(e),this.layout.layout(n),this.diffY=n.x-e.x,this.rootWidth=e.height,n.children=t.children,n}renewXY(t){[t.x,t.y]=[t.y,t.x],t.left&&(t.x=-t.x+this.rootWidth,t.y+=this.diffY)}getRootWidth(){return this.rootWidth}setBoundingBox(t,e){this.layout=dn(t,e),this.renew()}find(t){const e=t.split("-").map((t=>~~t));let n=this.data;for(let a=1;a<e.length;a++){const t=e[a],{children:s}=n;if(!(t<s.length))return null;n=s[t]}return n.id===t?n:null}rename(t,e){if(t.length>0){const n=this.find(t);if(n&&n.name!==e){n.name=e,n.rawData.name=e;const t=this.getSize(n.name);n.width=t.width,n.height=t.height,this.renew()}return n}return null}moveChild(t,e){var n,a;if(t===e)return null;const s=this.find(t),l=this.find(e),o=e.split("-").pop();if(o&&s&&l){const t=l.parent;null==(n=null==t?void 0:t.children)||n.splice(~~o,1),null==(a=null==t?void 0:t.rawData.children)||a.splice(~~o,1),l.parent=s,l.gKey=this.gKey+=1,l.depth=l.parent.depth+1,1===l.depth?l.color=this.colorScale(`${this.colorNumber+=1}`):l.left=l.parent.left,s.collapse?s._children.push(l):s.children.push(l),s.rawData.children?s.rawData.children.push(l.rawData):s.rawData.children=[l.rawData],this.renew(an,ln)}return l}moveSibling(t,e,n=0){const a=t.split("-"),s=e.split("-");let l=a.pop(),o=s.pop();if(t===e||a.length!==s.length||!l||!o)return null;const i=this.find(t),r=this.find(e);if(r&&i&&i.parent){l=parseInt(l,10),o=parseInt(o,10),l<o&&(o-=1);const{children:t}=i.parent,{children:e}=i.parent.rawData;if(t&&e)return t.splice(l,1),t.splice(o+n,0,i),e.splice(l,1),e.splice(o+n,0,i.rawData),1===i.depth&&(i.left=r.left),this.renew(an),i}return null}add(t,e){const n=this.find(t);if(n){if(n.collapse&&this.expand(t),n.rawData.children||(n.rawData.children=[]),"string"==typeof e){const t=e,a=this.getSize(t),s={name:t},l=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),o={id:`${n.id}-${n.children.length}`,name:t,rawData:s,parent:n,left:n.left,collapse:!1,color:l,gKey:this.gKey+=1,width:a.width,height:a.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(o),n.rawData.children.push(s),this.renew(),o}{const t=e,a=this.createMdataFromData(t,`${n.id}-${n.children.length}`,n);return n.children.push(a),n.rawData.children.push(t),this.renew(),a}}return null}expand(t){return this.eoc(t,!1,[ln,an])}collapse(t){return this.eoc(t,!0)}eoc(t,e,n=[]){const a=this.find(t);return a&&(a.collapse=e,a.rawData.collapse=e,[a._children,a.children]=[a.children,a._children],this.renew(...n)),a}delete(t){const e=this.find(t);if(!e||!e.parent)throw new Error(e?"暂不支持删除根节点":"未找到需要删除的节点");e.id="del",this.renew(an)}deleteOne(t){var e;const n=this.find(t);if(n&&n.parent){const{parent:a,children:s,_children:l,collapse:o,rawData:i}=n,r=parseInt(t.split("-").pop(),10);a.children.splice(r,1,...o?l:s),null==(e=a.rawData.children)||e.splice(r,1,...i.children||[]),s.forEach((t=>{t.parent=a,1===t.depth&&(t.rawData.left=t.left)})),this.renew(an)}}addSibling(t,e,n=!1){var a;const s=this.find(t);if(s&&s.parent){const l=parseInt(t.split("-").pop(),10),{parent:o,left:i}=s,r={name:e,left:i},d=this.getSize(e),c=n?l:l+1,h={name:e,parent:o,children:[],_children:[],color:o.color?o.color:this.colorScale(`${this.colorNumber+=1}`),collapse:!1,rawData:r,id:`${o.id}-${c}`,left:i,gKey:this.gKey+=1,depth:s.depth,width:d.width,height:d.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return o.children.splice(c,0,h),null==(a=o.rawData.children)||a.splice(c,0,r),this.renew(an),h}return null}addParent(t,e){var n;const a=this.find(t);if(a&&a.parent){const{parent:t,left:s,color:l}=a,o=this.getSize(e),i=parseInt(a.id.split("-").pop(),10),r={name:e,children:[a.rawData],left:s};null==(n=t.rawData.children)||n.splice(i,1,r);const d={rawData:r,left:s,name:e,color:l,collapse:!1,parent:t,id:a.id,depth:a.depth,width:o.width,height:o.height,gKey:this.gKey+=1,children:[a],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return a.parent=d,t.children.splice(i,1,d),this.renew(an),d}return null}changeLeft(t){const e=this.find(t);return e&&(e.left=!e.left,this.renew()),e}}let hn;W.on("mmdata",(t=>t?hn=t:null));const pn=(t=!0)=>{t&&Qt.snap(hn.data),Xt.emit("update:modelValue",b([hn.data.rawData])),te.value=Qt.hasPrev,ee.value=Qt.hasNext,Ge()},un=(t,e)=>{hn.rename(t,e),pn()},gn=(t,e)=>{hn.moveChild(t,e),pn()},mn=(t,e,n=0)=>{hn.moveSibling(t,e,n),pn()},fn=(t,e)=>{const n=hn.add(t,e);return pn(),n},vn=t=>{hn.delete(t),pn()},bn=t=>{hn.deleteOne(t),pn()},xn=t=>{hn.expand(t),pn()},yn=t=>{hn.collapse(t),pn()},wn=(t,e,n=!1)=>{const a=hn.addSibling(t,e,n);return pn(),a},Mn=(t,e)=>{const n=hn.addParent(t,e);return pn(),n},_n=t=>{hn.changeLeft(t),pn()};var kn=x({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,n){const a=e(!1),s=y(),l=e(),o=e(),i=w({top:0,left:0});W.on("showContextmenu",(async e=>{if(!l.value||!o.value)return;a.value=!!e,await M();const{offsetWidth:n,offsetHeight:s}=l.value,{offsetWidth:r,offsetHeight:d}=o.value,{top:c,left:h}=t.position;i.top=c+d>s?s-d-8:c,i.left=h+r>n?h-r:h}));const r=()=>a.value=!1;return{style:s,show:a,close:r,onClick:t=>{r(),n.emit("click-item",t)},menuEle:o,containerEle:l,pos:i}}});var $n={container:"Contextmenu_container_154ic",menu:"Contextmenu_menu_154ic",disabled:"Contextmenu_disabled_154ic"};(kn.__cssModules={}).$style=$n,kn.render=function(t,e,n,a,s,l){return _((L(),$("div",{class:t.style.container,ref:"containerEle"},[C("div",{onMousedown:e[1]||(e[1]=(...e)=>t.close&&t.close(...e))},null,32),C("div",{ref:"menuEle",id:t.style.menu,style:{top:t.pos.top+"px",left:t.pos.left+"px"}},[(L(!0),$(B,null,E(t.groups,((e,n)=>(L(),$("ul",{key:n},[(L(!0),$(B,null,E(e,(e=>(L(),$("li",{class:e.disabled?t.style.disabled:"",key:e.name,onClick:n=>t.onClick(e.name)},S(e.title),11,["onClick"])))),128))])))),128))],12,["id"])],2)),[[k,t.show]])};var Cn=x({name:"Mindmap",components:{Contextmenu:kn},props:{modelValue:{type:Array,required:!0},xGap:{type:Number,default:It},yGap:{type:Number,default:jt},branch:{type:Number,default:Vt,validator:t=>t>=1&&t<=6},scaleExtent:{type:Object,default:At},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean},setup:(t,e)=>(N((()=>W.emit("scale-extent",t.scaleExtent))),N((()=>W.emit("branch",t.branch))),N((()=>W.emit("sharp-corner",t.sharpCorner))),N((()=>W.emit("gap",{xGap:t.xGap,yGap:t.yGap}))),N((()=>W.emit("mindmap-context",e))),N((()=>Ft.value=t.edit&&t.addNodeBtn)),N((()=>Zt.drag=t.drag)),N((()=>Zt.edit=t.edit)),D((()=>{if(!(R.value&&T.value&&U.value&&q.value&&F.value))return;W.emit("selection-svg",a(R.value)),W.emit("selection-g",a(T.value)),W.emit("selection-asstSvg",a(U.value)),W.emit("selection-foreign",a(q.value)),W.emit("mmdata",new cn(h.cloneDeep(t.modelValue[0]),It,jt,ie)),Pt.value=!1,pn();const{svg:e,foreign:n}=K;null==n||n.raise(),F.value&&(Jt.observe(F.value),F.value.addEventListener("blur",et),F.value.addEventListener("mousedown",(t=>t.stopPropagation()))),ce(),null==e||e.on("mousedown",(()=>{const t=document.getElementsByClassName(Y.selected)[0];null==t||t.classList.remove(Y.selected)})),it(t.zoom),rt(t.ctm)})),z((()=>[t.branch,Ft.value,t.sharpCorner]),(()=>{Ge(),Pt.value=!1})),z((()=>[t.xGap,t.yGap]),(t=>{hn.setBoundingBox(t[0],t[1]),Ge()})),z((()=>[t.drag,t.edit]),(t=>{(t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.${Y.text}`);t?n.on("mousedown",Q):n.on("mousedown",null)})(t[0]||t[1]),(t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.node:not(.${Y.root}) > g > g.${Y.text}`);t?qt(n):n.on(".drag",null)})(t[0]),(t=>{const{g:e}=K;if(!F.value||!e)return;const n=e.selectAll(`g.${Y.text}`);t?n.on("click",tt):n.on("click",null)})(t[1])})),z((()=>t.zoom),(t=>it(t))),z((()=>t.ctm),(t=>rt(t))),{wrapperEle:H,svgEle:R,gEle:T,style:Y,asstSvgEle:U,foreignEle:q,foreignDivEle:F,centerView:de,fitView:ce,download:ue,menu:Et,contextmenuPos:gt,onClickMenu:at,next:ge,prev:me,hasPrev:te,hasNext:ee})});const Bn={ref:"gEle"},En={ref:"foreignEle",style:{display:"none"}},Ln={ref:"foreignDivEle",contenteditable:""};Cn.render=function(t,e,n,a,s,l){const o=P("contextmenu");return L(),$("div",{class:t.style.container},[C("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(L(),$("svg",{class:t.style.svg,ref:"svgEle"},[C("g",Bn,[(L(),$("foreignObject",En,[C("div",Ln,null,512)],512))],512)],2))],8,["id"]),(L(),$("svg",{ref:"asstSvgEle",class:t.style["asst-svg"]},null,2)),C("div",{class:[t.style["button-list"],t.style["right-bottom"]]},[t.centerBtn?(L(),$("button",{key:0,onClick:e[1]||(e[1]=e=>t.centerView())},[C("i",{class:t.style.gps},null,2)])):V("",!0),t.fitBtn?(L(),$("button",{key:1,onClick:e[2]||(e[2]=e=>t.fitView())},[C("i",{class:t.style.fit},null,2)])):V("",!0),t.downloadBtn?(L(),$("button",{key:2,onClick:e[3]||(e[3]=e=>t.download())},[C("i",{class:t.style.download},null,2)])):V("",!0)],2),t.timetravel?(L(),$("div",{key:0,class:[t.style["button-list"],t.style["right-top"]]},[C("button",{onClick:e[4]||(e[4]=(...e)=>t.prev&&t.prev(...e)),class:{[t.style.disabled]:!t.hasPrev}},[C("i",{class:t.style.prev},null,2)],2),C("button",{onClick:e[5]||(e[5]=(...e)=>t.next&&t.next(...e)),class:{[t.style.disabled]:!t.hasNext}},[C("i",{class:t.style.next},null,2)],2)],2)):V("",!0),t.ctm?(L(),$(o,{key:1,position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])):V("",!0)],2)};var Sn=x({name:"MapEditor",components:{Mindmap:Cn},props:["tree"],data:()=>({renderComponent:!1,dataJson:[],dataM:[]}),watch:{dataM(){this.dataJson=JSON.stringify(this.dataM,null,2)}},methods:{updateMap(){this.renderComponent=!1,this.dataM=JSON.parse(this.dataJson),this.renderComponent=!0}},mounted(){this.dataM=this.tree,this.renderComponent=!0},setup:()=>({checkboxList:w({"center-btn":{value:!0},"fit-btn":{value:!0},timetravel:{value:!0},"download-btn":{value:!0},"add-node-btn":{value:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},"sharp-corner":{value:!1}}),rangeList:w({branch:{value:4,min:1,max:6},"x-gap":{value:84,min:0,max:100},"y-gap":{value:18,min:0,max:100}})})});const Nn={class:"container",ref:"capture"},Dn=C("div",{class:"left-top"}," Mind Map based on vue3-mindmap ",-1),zn=C("div",{class:"right-top"},[C("span",null,"Props")],-1),Pn={class:"right-bottom"},Vn={class:"preview"};Sn.render=function(t,e,n,a,s,l){const o=P("mindmap");return L(),$("div",Nn,[Dn,zn,t.renderComponent?(L(),$(o,{key:0,class:"left-bottom",modelValue:t.dataM,"onUpdate:modelValue":e[1]||(e[1]=e=>t.dataM=e),branch:t.rangeList.branch.value,"x-gap":t.rangeList["x-gap"].value,"y-gap":t.rangeList["y-gap"].value,zoom:t.checkboxList.zoom.value,"fit-btn":t.checkboxList["fit-btn"].value,"center-btn":t.checkboxList["center-btn"].value,"download-btn":t.checkboxList["download-btn"].value,drag:t.checkboxList.drag.value,edit:t.checkboxList.edit.value,"add-node-btn":t.checkboxList["add-node-btn"].value,"sharp-corner":t.checkboxList["sharp-corner"].value,ctm:t.checkboxList.contextmenu.value,timetravel:t.checkboxList.timetravel.value},null,8,["modelValue","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel"])):V("",!0),C("div",Pn,[(L(!0),$(B,null,E(t.checkboxList,((t,e)=>(L(),$("div",{key:e},[_(C("input",{type:"checkbox",name:e.toString(),"onUpdate:modelValue":e=>t.value=e,disabled:t.disabled},null,8,["name","onUpdate:modelValue","disabled"]),[[O,t.value]]),C("label",{for:e.toString()},S(e),9,["for"])])))),128)),(L(!0),$(B,null,E(t.rangeList,((t,e)=>(L(),$("div",{key:e},[_(C("input",{type:"range",name:e,"onUpdate:modelValue":e=>t.value=e,min:t.min,max:t.max},null,8,["name","onUpdate:modelValue","min","max"]),[[A,t.value,void 0,{number:!0}]]),C("label",{for:e},S(e)+"（"+S(t.value)+"）",9,["for"])])))),128)),C("div",Vn,[_(C("textarea",{"onUpdate:modelValue":e[2]||(e[2]=e=>t.dataJson=e),rows:"20",cols:"50",onChange:e[3]||(e[3]=(...e)=>t.updateMap&&t.updateMap(...e)),"data-gramm":"false","data-gramm_editor":"false"},"\n      ",544),[[A,t.dataJson]])])])],512)};const An={name:"App",components:{MapEditor:Sn},data:()=>({showMap:!1,info:"{}",formatted:[]}),methods:{format(){if(""!==this.info){this.showMap=!1;let n=JSON.parse(this.info);if("edges"in n&&"nodes"in n){for(var t=0,e=0;e<=n.edges.length;e++)n.nodes[e].name=n.nodes[e].text,e!==n.edges.length&&(n.nodes[n.edges[e].childId-1].parentId=n.edges[e].parentId,1===n.nodes[e].parentId&&++t%2==0&&(n.nodes[e].left=!0));let a=j(n.nodes,{parentProperty:"parentId",customID:"id"});a=this.removeProp(a,"id"),a=this.removeProp(a,"text"),a=this.removeProp(a,"parentId"),this.formatted=JSON.parse(JSON.stringify(a)),this.showMap=!0}}},removeProp(t,e){for(var n in t)if("object"==typeof t[n]){delete t.property;let a=this.removeProp(t[n],e);t[n]=a}else n===e&&delete t[n];return t},loadExample(t){this.showMap=!1,I.get("/"+t).then((t=>this.info=JSON.stringify(t.data,2," ")))}}},On={id:"app"},jn={key:0,class:"source"},In={key:2};An.render=function(t,e,n,a,s,l){const o=P("MapEditor");return L(),$("div",On,[s.showMap?V("",!0):(L(),$("div",jn,[_(C("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.info=t),rows:"50",cols:"200","data-gramm":"false","data-gramm_editor":"false"},null,512),[[A,s.info]])])),C("button",{onClick:e[2]||(e[2]=G((t=>l.loadExample("example.json")),["prevent"]))},"Load Example 1"),C("button",{onClick:e[3]||(e[3]=G((t=>l.loadExample("example2.json")),["prevent"]))},"Load Example 2"),s.showMap?V("",!0):(L(),$("button",{key:1,onClick:e[4]||(e[4]=G(((...t)=>l.format&&l.format(...t)),["prevent"]))},"Generate mind map")),s.showMap?(L(),$("div",In,[C(o,{tree:s.formatted},null,8,["tree"])])):V("",!0)])},J(An).mount("#app");
